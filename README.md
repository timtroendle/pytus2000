# PyTUS2000

A library for working with the [UK Time Use Study 2000](https://discover.ukdataservice.ac.uk/catalogue?sn=4504) data.

## User Guide

`pytus2000` comes with classes for all categorial data in the UK Time Use Study and hence provides you with metadata and tab-completion while you are working with the data set. As an example consider you want to filter out all adult diary data. Instead of a query like this:

```python
adults = diary_data[diary_data.DTYPE == 1]
```

`pytus2000` lets you write:

```python
adults = diary_data[diary_data.DTYPE == diary.DTYPE.ADULT_DIARY]
```

Start by reading in a tab-delimited data set as a pandas DataFrame like so:

```python
import pytus2000 as tus
from pytus2000 import diary

tus.set_cache_location('<path_to_cachedir>') # caches the pandas dataframe, next read will be fast
diary_data = tus.read_diary_file('<path_to_file>')
```

### Installation

#### From source code

1) Download [tab delimited data set](https://discover.ukdataservice.ac.uk/catalogue?sn=4504).

2) Auto-generate the source code by running `./scripts/convert_rtf.py` and `./scripts/generate_code.py`. Help for both scripts is available through:

    python ./scripts/<script>.py --help

3) `pip install .`

## Developer Guide

### Prepare your environment

#### Download and extract data set

To run all tests and to generate the source code, you will need the original data set. Extract it into `./data/` so that it will be discovered by the test runner. Your directory should look like this:

    ./data/
        4504_file_information.rtf
        mrdoc/
            ...
        read4504.txt
        tab/
            ...
    ./pytus2000/
        ...
    ...

#### Convert rtf

The original data dictionaries come in rtf format. For running the tests and generating the source code, you will need to convert them to plain text first. Make sure you have a Python 2 environment with `pyth`, `click`, and `pathlib` installed and run:

    python ./scripts/convert_rtf.py ./data/mrdoc/allissue/ ./data/mrdoc/allissue/

#### Auto-generate data dictionaries

    python ./scripts/generate_code.py ./data/mrdoc/allissue/

You will need to repeat this step whenever you do changes to the script generating the code.

#### Install pytus

Make sure you have the source code autogenerated, see above. Best install `pytus2000` in editable mode:

    $ pip install -e .

### Run the test suite

Make sure you have set up your environment as described above. Run the test suite with py.test:

    $ py.test

Tests including the data set are skipped by default, as the data set might be unavailable and tests are slow. To run all tests run:

    $ py.test --runwithdataset
